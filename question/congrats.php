<?php session_start();include_once("submit.php");if(isset($_POST) && !empty($_POST['answer'])){	$db_user = new Users();	$weightage = $db_user->calcWeightage($_POST['answer']);	$db_user->transferData($_POST['name'], $_POST['email'], $_POST['phone']);	$claimfree = (isset($_POST['claimfree'])) ? $_POST['claimfree'] : "no";	$db_user->saveUser(array(			'name' => $_POST['name'], 			'email' => $_POST['email'], 			'phone' => $_POST['phone'],			'ans' => $_POST['answer'],			'weightage' => $weightage,			'claimfree' => $claimfree		));		$congrats_text = "";$congrats_title ="";	if($weightage >= 79){		$congrats_title = "Music<br>Geek";		$congrats_fb = "Music Geek";		$congrats_text = "You are a Music Geek, or what we call a Museek! You truly live music and don't draw lines when it comes to music, because there is no life without music. <br><br>You like to feel the music in your ears and in your fingers, all the time. City of Music is just the place for you to be."	;	}	else if($weightage >= 49 && $weightage < 78){		$congrats_title = "Music<br>Chiller";		$congrats_fb = "Music Chiller";		$congrats_text = "You are a Music Chiller, or what we call a Miller! You love your music in all aspects of your life, but you don't yet live music!<br><br>To enhance your  MQ, may we suggest a quick visit to City of Music."	;	}	else{		$congrats_title = "Music<br>Snacker";		$congrats_fb = "Music Snacker";		$congrats_text = "You are a Music Snacker, or what we call a Macker! You love your music in small doses and appreciate it, but its not an integral part of your life yet!<br><br>To enhance your  MQ, may we suggest a quick visit to City of Music."	;	}	$shareImg = 'https://dl.dropboxusercontent.com/u/54623720/fb-promo.jpg';	if(isset($_POST['fbid'])){		 $_SESSION['TITLE'] =  $congrats_title;		 $_SESSION['weightage'] = $weightage;		 $_SESSION['fbid'] = $_POST['fbid'];		 $_SESSION['congrats_text'] = $congrats_text;		  $_SESSION['congrats_fb'] = $congrats_fb;		  $_SESSION['NAME'] = $_POST['name'];		$dest = imagecreatefromjpeg('back1.jpg');		$src = imagecreatefromjpeg('http://graph.facebook.com/'. $_POST['fbid'] .'/picture?type=large');				imagealphablending($dest, false);		imagesavealpha($dest, true);		imagecopymerge($dest, $src, 50, 80, 0, 0, 528, 275, 100); //have to play with these numbers for it to work for you, etc.		  //Set the Content Type		//header('Content-type: image/jpeg');		imagejpeg($dest, 'userimage/'. $_POST['fbid'].'.jpg', 100);		imagedestroy($dest);		imagedestroy($src);		$dest = imagecreatefromjpeg('userimage/'. $_POST['fbid'].'.jpg');		$src = imagecreatefrompng('temp1.png');		imagealphablending($dest, true);		imagesavealpha($dest, true);		imagecopy($dest, $src, 0, 0, 0, 0,528, 275); //have to play with these numbers for it to work for you, etc.		imagejpeg($dest, 'userimage/'. $_POST['fbid'].'.jpg', 100);		imagedestroy($dest);		imagedestroy($src);		//  header('Content-type: image/jpeg');		  // Create Image From Existing File		  $jpg_image = imagecreatefromjpeg('userimage/'. $_POST['fbid'].'.jpg');		  // Allocate A Color For The Text		  $white = imagecolorallocate($jpg_image, 206, 8, 155);		  // Set Path to Font File		  $font_path = 'fonts/BebasNeueRegular.ttf';		  // Set Text to Be Printed On Image		  $text = $weightage;		  // Print Text On Image          $uniq = uniqid();		  imagettftext($jpg_image, 55, 0, 370, 150, $white, $font_path, $text);		  // Send Image to Browser		  imagejpeg($jpg_image,'userimage/'. $_POST['fbid']. 'ab'. $uniq. '.jpg', 100);		  // Clear Memory		  imagedestroy($jpg_image);		  		  $shareImg = 'http://mq.cityofmusic.in/question/userimage/'. $_POST['fbid']. 'ab'. $uniq. '.jpg';		  	}	 $_SESSION['shareImg'] = $shareImg;}else{	die();}?><!DOCTYPE html><html lang="en">  <head>    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1">    <!-- <meta property="og:title" content="What's Your Musical Quotient? Find out right now !! Designed by City Of Music">    <meta property="og:image" content="https://dl.dropboxusercontent.com/u/54623720/fb-promo.jpg">    <meta property="og:site_name" content="Musical Quotient by City of Music">    <meta property="og:url" content="http://www.cityofmusic.in">    <meta property="og:description" content="Take this 3 minute test HONESTLY and when youâ€™re done, your MQ score will show you what exactly plucks your strings!"> -->    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->    <title>Find your Music Quotient by City of Music</title>    <!-- Bootstrap -->    <link href="css/bootstrap.min.css" rel="stylesheet">    <link rel="stylesheet" href="css/font-awesome.min.css">    <link href="css/style.css" rel="stylesheet">      <link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,400italic' rel='stylesheet' type='text/css'>     <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->    <!--[if lt IE 9]>      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>    <![endif]-->    <script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-66668958-1', 'auto');  ga('send', 'pageview');</script>  </head>  <body>    <div class="container-fluid">    	<div class="row padtop-xs">	    	<div class="col-sm-offset-4 col-sm-4 col-xs-12">	    		<div class="text-center whats">WHATS YOUR</div>	    		<div class="col-sm-offset-3 col-sm-6 col-xs-offset-3 col-xs-6"><a href="/index.html"><img src="img/MQ-logo.png" class="img-responsive"></a></div>	    	</div>    	</div>    	    	<div class="row padtop-sm">			<div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10 pad0">				<div class="panel panel-default" style="border:0px solid rgba(0,0,0,0); border-radius:5px;">					<div class="panel-title pad-sm">						<div style="text-align:center; font-size: 24px;">							Congratulations <?php $pieces = explode(" ", $_POST['name']); echo  $pieces[0] ?>!						</div>						<div class="panel panel-default congrats c marbot0">							<div class="panel-title pad-sm padtop-sm row">								<div class="col-sm-5 col-xs-6 text-center">									<p class="quest"> Your MQ IS</p>									<p class="score" data-to='<?php echo $weightage ?>' data-easing='easeInCubic' id="myTargetElement"><?php echo $weightage ?></p>								</div>								<div class="col-sm-offset-1 col-sm-6 col-xs-6 text-center">									<p class="quest green">You are A</p>									<p class="badge green"><?php echo $congrats_title ?></p>								</div>							</div>						</div>					</div>					<div class="panel-body pad0">						<div class="text-center share desk"><p>Share with your friends & get a free ride to <br>City of Music</p></div>                        <div class="text-center share mob"><p>Share with your friends & get a free ride to City of Music</p></div>						<!-- <div class="col-sm-6 col-xs-6 whatsapp text-center mob">							<a href="whatsapp://send?text=I have an MQ of <?php echo $weightage ?>.Find your MQ at http://mq.cityofmusic.in!" data-action="share/whatsapp/share">								<i class="fa fa-whatsapp pad-sm" aria-hidden="true"></i>							</a>						</div> -->						<!--<div class="col-sm-6 col-xs-6 twitter text-center desk">							<a class="twitter-share-popups" href="https://twitter.com/intent/tweet?button_hashtag=cityofmusic&text=I got an MQ of <?php echo $weightage ?>. I challenge you to find yours.&url=http://mq.cityofmusic.in/"    data-url="http://mq.cityofmusic.in/question/index.html"    class="twitter-share-popups twtr-icon"     data-lang="es"    data-related="I got an MQ of <?php echo $weightage ?>. I challenge you to find yours."     data-hashtags="cityofmusic,mq"     title="Twitter"    target="_blank">								<i class="fa fa-twitter pad-sm" aria-hidden="true"></i>							</a>						</div>-->                        <a href="#" onclick="shareonfb();">    						<div class="col-sm-12 col-xs-12 facebook text-center">    							<span style="display:inline-block;"><i class="fa fa-facebook pad-sm" aria-hidden="true"></i></span>                                <span style="display:inline-block;"><p class="white" style="">Share</p></span>    						</div>                        </a>					</div>				</div>			</div>		</div>		<div class="row">			<div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10 text-center white1">				<p><?php echo $congrats_text ?></p>			</div>		</div>		<div class="row">			<div class="col-sm-offset-4 col-sm-4 col-xs-offset-3 col-xs-6">				<div class="text-center white lin-less"><p>Know More About</p></div>				<div class="col-sm-offset-3 col-sm-6 col-xs-offset-1 col-xs-10"><a href="/index.html"><img src="img/COM-logo.png" class="img-responsive logo"></a></div>			</div>		</div>    </div>    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>    <script src="js/countUp.js"></script>    <!-- Include all compiled plugins (below), or include individual files as needed -->    <script src="js/bootstrap.min.js"></script>	<script>  window.fbAsyncInit = function() {    FB.init({      appId      : '1094877153889333',      xfbml      : true,      version    : 'v2.6'    });  };  (function(d, s, id){     var js, fjs = d.getElementsByTagName(s)[0];     if (d.getElementById(id)) {return;}     js = d.createElement(s); js.id = id;     js.src = "//connect.facebook.net/en_US/sdk.js";     fjs.parentNode.insertBefore(js, fjs);   }(document, 'script', 'facebook-jssdk'));</script>	<script>		function shareonfb(){		FB.ui({method: 'feed',  link: 'http://mq.cityofmusic.in/question/index.html',                            name: ' I got an MQ of <?php echo $weightage ?>. I challenge you to find yours',                            caption: 'City of Music',                            description: 'So I just found out that as per my music quotient I am a <?php echo $congrats_fb ?>. Wow!',                            picture: '<?php echo $shareImg; ?>'                            }, function(response) {                                    window.location = "/congrats.php";                                                                                                           });			}	</script>	<script>            $('.twitter-share-popups').click(function (event) {    var width = 575,            height = 400,            left = ($(window).width() - width) / 2,            top = ($(window).height() - height) / 2,            url = this.href,            opts = 'status=1' +            ',width=' + width +            ',height=' + height +            ',top=' + top +            ',left=' + left;            window.open(url, 'twitter', opts);            return false;    });</script>    <script type="text/javascript">            var SCREEN_WIDTH = window.innerWidth,                SCREEN_HEIGHT = window.innerHeight,                mousePos = {                    x: 400,                    y: 300                },                // create canvas                canvas = document.createElement('canvas'),                context = canvas.getContext('2d'),                particles = [],                rockets = [],                MAX_PARTICLES = 500,                colorCode = 0;            // init            $(document).ready(function() {                document.body.appendChild(canvas);                canvas.width = SCREEN_WIDTH;                canvas.height = SCREEN_HEIGHT;                setInterval(launch, 200);                setInterval(loop, 600 / 50);            });            // update mouse position            $(document).mousemove(function(e) {                e.preventDefault();                mousePos = {                    x: e.clientX,                    y: e.clientY                };            });            // launch more rockets!!!            $(document).mousedown(function(e) {                for (var i = 0; i < 5; i++) {                    launchFrom(Math.random() * SCREEN_WIDTH * 2 / 3 + SCREEN_WIDTH / 6);                }            });            function launch() {                launchFrom(mousePos.x);            }            function launchFrom(x) {                if (rockets.length < 10) {                    var rocket = new Rocket(x);                    rocket.explosionColor = Math.floor(Math.random() * 360 / 10) * 10;                    rocket.vel.y = Math.random() * -3 - 4;                    rocket.vel.x = Math.random() * 4 - 3;                    rocket.size = 4;                    rocket.shrink = 0.999;                    rocket.gravity = 0.01;                    rockets.push(rocket);                }            }            function loop() {                // update screen size                if (SCREEN_WIDTH != window.innerWidth) {                    canvas.width = SCREEN_WIDTH = window.innerWidth;                }                if (SCREEN_HEIGHT != window.innerHeight) {                    canvas.height = SCREEN_HEIGHT = window.innerHeight;                }                                    //defining the grd                var grd=context.createLinearGradient(0,0,SCREEN_WIDTH,0);                    grd.addColorStop(0,"rgba(255, 0, 255, .5)");                    grd.addColorStop(1,"rgba(0, 255, 255, .5)");                                // clear canvas                context.fillStyle=grd;                context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);                var existingRockets = [];                for (var i = 0; i < rockets.length; i++) {                    // update and render                    rockets[i].update();                    rockets[i].render(context);                    // calculate distance with Pythagoras                    var distance = Math.sqrt(Math.pow(mousePos.x - rockets[i].pos.x, 2) + Math.pow(mousePos.y - rockets[i].pos.y, 2));                    // random chance of 1% if rockets is above the middle                    var randomChance = rockets[i].pos.y < (SCREEN_HEIGHT * 2 / 3) ? (Math.random() * 100 <= 1) : false;            /* Explosion rules                         - 80% of screen                        - going down                        - close to the mouse                        - 1% chance of random explosion                    */                    if (rockets[i].pos.y < SCREEN_HEIGHT / 5 || rockets[i].vel.y >= 0 || distance < 50 || randomChance) {                        rockets[i].explode();                    } else {                        existingRockets.push(rockets[i]);                    }                }                rockets = existingRockets;                var existingParticles = [];                for (var i = 0; i < particles.length; i++) {                    particles[i].update();                    // render and save particles that can be rendered                    if (particles[i].exists()) {                        particles[i].render(context);                        existingParticles.push(particles[i]);                    }                }                // update array with existing particles - old particles should be garbage collected                particles = existingParticles;                while (particles.length > MAX_PARTICLES) {                    particles.shift();                }            }            function Particle(pos) {                this.pos = {                    x: pos ? pos.x : 0,                    y: pos ? pos.y : 0                };                this.vel = {                    x: 0,                    y: 0                };                this.shrink = .97;                this.size = 10;                this.resistance = 1.02;                this.gravity = 0;                this.flick = false;                this.alpha = 1;                this.fade = 0;                this.color = 0;            }            Particle.prototype.update = function() {                // apply resistance                this.vel.x *= this.resistance;                this.vel.y *= this.resistance;                // gravity down                this.vel.y += this.gravity;                // update position based on speed                this.pos.x += this.vel.x;                this.pos.y += this.vel.y;                // shrink                this.size *= this.shrink;                // fade out                this.alpha -= this.fade;            };            Particle.prototype.render = function(c) {                if (!this.exists()) {                    return;                }                c.save();                c.globalCompositeOperation = 'lighter';                var x = this.pos.x,                    y = this.pos.y,                    r = this.size / 2;                var gradient = c.createRadialGradient(x, y, 0.1, x, y, r);                gradient.addColorStop(0.1, "rgba(255,255,255," + this.alpha + ")");                gradient.addColorStop(0.8, "hsla(" + this.color + ", 100%, 50%, " + this.alpha + ")");                gradient.addColorStop(1, "hsla(" + this.color + ", 100%, 50%, 0.1)");                c.fillStyle = gradient;                c.beginPath();                c.arc(this.pos.x, this.pos.y, this.flick ? Math.random() * this.size : this.size, 0, Math.PI * 2, true);                c.closePath();                c.fill();                c.restore();            };            Particle.prototype.exists = function() {                return this.alpha >= 0.1 && this.size >= 1;            };            function Rocket(x) {                Particle.apply(this, [{                    x: x,                    y: SCREEN_HEIGHT}]);                this.explosionColor = 0;            }            Rocket.prototype = new Particle();            Rocket.prototype.constructor = Rocket;            Rocket.prototype.explode = function() {                var count = Math.random() * 10 + 80;                for (var i = 0; i < count; i++) {                    var particle = new Particle(this.pos);                    var angle = Math.random() * Math.PI * 2;                    // emulate 3D effect by using cosine and put more particles in the middle                    var speed = Math.cos(Math.random() * Math.PI / 2) * 15;                    particle.vel.x = Math.cos(angle) * speed;                    particle.vel.y = Math.sin(angle) * speed;                    particle.size = 10;                    particle.gravity = 0.2;                    particle.resistance = .92;                    particle.shrink = Math.random() * 0.05 + 0.93;                    particle.flick = true;                    particle.color = this.explosionColor;                    particles.push(particle);                }            };            Rocket.prototype.render = function(c) {                if (!this.exists()) {                    return;                }                c.save();                c.globalCompositeOperation = 'lighter';                var x = this.pos.x,                    y = this.pos.y,                    r = this.size / 2;                var gradient = c.createRadialGradient(x, y, 0.1, x, y, r);                gradient.addColorStop(0.1, "rgba(0, 0, 0," + this.alpha + ")");                gradient.addColorStop(1, "rgba(255, 255, 255, " + this.alpha + ")");                c.fillStyle = gradient;                c.beginPath();                c.arc(this.pos.x, this.pos.y, this.flick ? Math.random() * this.size / 2 + this.size / 2 : this.size, 0, Math.PI * 2, true);                c.closePath();                c.fill();                c.restore();            };    </script>    <script>        var options = {        useEasing : true,         useGrouping : true,         separator : ',',         decimal : '.',         prefix : '',         suffix : ''         };        var demo = new CountUp("myTargetElement", 0, <?php echo $weightage ?>, 0, 2.5, options);        demo.start();    </script>    <!-- Google Code for Remarketing Tag -->        <script type="text/javascript">        /* <![CDATA[ */        var google_conversion_id = 935638599;        var google_custom_params = window.google_tag_params;        var google_remarketing_only = true;        /* ]]> */        </script>        <script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">        </script>        <noscript>        <div style="display:inline;">        <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/935638599/?value=0&amp;guid=ON&amp;script=0"/>        </div>        </noscript>        <!-- AB-Facebook Pixel Code --><script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init', '142719309466130');fbq('track', "PageView");</script><noscript><img height="1" width="1" style="display:none"src="https://www.facebook.com/tr?id=142719309466130&ev=PageView&noscript=1"/></noscript><!-- End Facebook Pixel Code -->  </body></html>